<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComplianceConnect</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent body scroll if content fits */
        }
        /* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
        main {
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react.development.js"></script>
    <!-- Babel –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è JSX –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs (v10.x.x, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // –î–µ–ª–∞–µ–º Firebase –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–ª—è Babel
        window.firebase = {
            initializeApp: initializeApp,
            getAuth: getAuth,
            signInAnonymously: signInAnonymously,
            signInWithCustomToken: signInWithCustomToken,
            onAuthStateChanged: onAuthStateChanged,
            signOut: signOut,
            createUserWithEmailAndPassword: createUserWithEmailAndPassword,
            signInWithEmailAndPassword: signInWithEmailAndPassword,
            getFirestore: getFirestore,
            doc: doc,
            getDoc: getDoc,
            addDoc: addDoc,
            setDoc: setDoc,
            updateDoc: updateDoc,
            deleteDoc: deleteDoc,
            onSnapshot: onSnapshot,
            collection: collection,
            query: query,
            where: where,
            getDocs: getDocs
        };
    </script>

    <!-- –í–∞—à –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è React -->
    <script type="text/babel">
        // –í–ê–ñ–ù–û: –ï—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª HTML –õ–û–ö–ê–õ–¨–ù–û (–Ω–µ –≤ —Å—Ä–µ–¥–µ Canvas),
        // –≤–∞–º –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å __app_id –∏ __firebase_config —Å–≤–æ–∏–º–∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Firebase.
        // –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –∏—Ö –≤ –∫–æ–Ω—Å–æ–ª–∏ Firebase –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ -> –û–±—â–∏–µ).
        //
        // –ü—Ä–∏–º–µ—Ä:
        // const __app_id = 'your-firebase-project-id';
        // const __firebase_config = JSON.stringify({
        //     apiKey: "YOUR_API_KEY",
        //     authDomain: "YOUR_AUTH_DOMAIN",
        //     projectId: "YOUR_PROJECT_ID",
        //     storageBucket: "YOUR_STORAGE_BUCKET",
        //     messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        //     appId: "YOUR_APP_ID",
        //     measurementId: "YOUR_MEASUREMENT_ID"
        // });
        //
        // –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ '–ó–∞–≥—Ä—É–∑–∫–∞...' –∏–ª–∏ '–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å', —ç—Ç–æ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ,
        // —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π Firebase.
        // –û—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏, –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —ç—Ç–æ –≤ —Å—Ä–µ–¥–µ Canvas,
        // —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –±—É–¥—É—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

        // –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–®–ò –î–ê–ù–ù–´–ï FIREBASE –ò –£–ë–ï–î–ò–¢–ï–°–¨, –ß–¢–û –û–ù–ò –í–ï–†–ù–´–ï –ò–ó –ö–û–ù–°–û–õ–ò FIREBASE:
        // –°–¢–†–û–ö–ò –ù–ò–ñ–ï –†–ê–°–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´. –í–ê–ú –ù–£–ñ–ù–û –¢–û–õ–¨–ö–û –ó–ê–ú–ï–ù–ò–¢–¨ –ó–ù–ê–ß–ï–ù–ò–Ø 'YOUR_...'
        //
        // *** –û–°–û–ë–û–ï –í–ù–ò–ú–ê–ù–ò–ï –ù–ê apiKey: –£–ë–ï–î–ò–¢–ï–°–¨, –ß–¢–û –û–ù –ù–ê–ß–ò–ù–ê–ï–¢–°–Ø –° "AIzaSy" –ò –ë–ï–ó –õ–ò–®–ù–ò–• –°–ò–ú–í–û–õ–û–í! ***
        //
        const __app_id = 'complianceconnect-design'; // –ü—Ä–∏–º–µ—Ä: 'my-project-12345'
        const __firebase_config = JSON.stringify({
            apiKey: "AIzaSyDr-M6dm-1yPObvAVwreIlxRUEAUrkoj94", // –ù–∞–ø—Ä–∏–º–µ—Ä: "AIzaSyC..." <-- –£–ë–ï–î–ò–¢–ï–°–¨, –ß–¢–û –ó–î–ï–°–¨ –ù–ï–¢ "Y" –ò–õ–ò –î–†–£–ì–ò–• –õ–ò–®–ù–ò–• –°–ò–ú–í–û–õ–û–í –ü–ï–†–ï–î "AIzaSy"
            authDomain: "complianceconnect-design.firebaseapp.com", // –ù–∞–ø—Ä–∏–º–µ—Ä: "my-project-12345.firebaseapp.com"
            projectId: "complianceconnect-design", // –ü—Ä–∏–º–µ—Ä: "my-project-12345"
            storageBucket: "complianceconnect-design.firebasestorage.app", // –ù–∞–ø—Ä–∏–º–µ—Ä: "my-project-12345.appspot.com"
            messagingSenderId: "759186517452", // –ù–∞–ø—Ä–∏–º–µ—Ä: "123456789012"
            appId: "1:759186517452:web:07250310b7ecb5b13a8169", // –ù–∞–ø—Ä–∏–º–µ—Ä: "1:123456789012:web:abcdef1234567890abcdef"
            measurementId: "G-L7PCZ3ECYS" // –ù–∞–ø—Ä–∏–º–µ—Ä: "G-XXXXXXXXXX"
        });


        const { useState, useEffect, createContext, useContext } = React;
        const { createRoot } = ReactDOM;
        const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword, getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } = window.firebase;

        // Context –¥–ª—è Firebase –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        const FirebaseContext = createContext(null);

        const App = () => {
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [userId, setUserId] = useState(null);
            const [userEmail, setUserEmail] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [currentPage, setCurrentPage] = useState('login'); // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –≤—Ö–æ–¥
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [showProfilePopup, setShowProfilePopup] = useState(false);
            const [showLoginPopup, setShowLoginPopup] = useState(true); // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ

            // –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const [selectedCategoryId, setSelectedCategoryId] = useState(null);
            const [selectedCategoryName, setSelectedCategoryName] = useState(null);
            const [selectedDocumentCategoryId, setSelectedDocumentCategoryId] = useState(null);
            const [selectedDocumentCategoryName, setSelectedDocumentCategoryName] = useState(null);
            const [selectedDocumentTypeId, setSelectedDocumentTypeId] = useState(null);
            const [selectedDocumentTypeName, setSelectedDocumentTypeName] = useState(null);

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ–±—â–µ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–∑–∞–º–µ–Ω–∞ alert)
            const [showGenericMessageModal, setShowGenericMessageModal] = useState(false);
            const [genericMessageTitle, setGenericMessageTitle] = useState('');
            const [genericMessageContent, setGenericMessageContent] = useState('');

            const displayMessage = (title, content) => {
                setGenericMessageTitle(title);
                setGenericMessageContent(content);
                setShowGenericMessageModal(true);
            };


            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            useEffect(() => {
                try {
                    let appIdValue = 'default-app-id';
                    let firebaseConfigObject = {};
                    let firebaseConfigString = '';

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ __app_id
                    if (typeof __app_id !== 'undefined' && __app_id !== 'complianceconnect-design') {
                        appIdValue = __app_id;
                        console.log("–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π appId:", appIdValue);
                    } else {
                        console.warn("–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è __app_id –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ (–≤–∞—à projectId).");
                    }

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ __firebase_config
                    // –ú—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ __firebase_config —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π JSON –±–ª–∞–≥–æ–¥–∞—Ä—è JSON.stringify()
                    if (typeof __firebase_config !== 'undefined' && __firebase_config !== '{"apiKey":"AIzaSyDr-M6dm-1yPObvAVwreIlxRUEAUrkoj94","authDomain":"complianceconnect-design.firebaseapp.com","projectId":"complianceconnect-design","storageBucket":"complianceconnect-design.firebasestorage.app","messagingSenderId":"759186517452","appId":"1:759186517452:web:07250310b7ecb5b13a8169","measurementId":"G-L7PCZ3ECYS"}') {
                        firebaseConfigString = __firebase_config;
                        console.log("–ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ __firebase_config:", firebaseConfigString);
                        try {
                            firebaseConfigObject = JSON.parse(firebaseConfigString);
                            console.log("–†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π firebaseConfigObject:", firebaseConfigObject); // –õ–æ–≥–∏—Ä—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
                        } catch (parseError) {
                            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ __firebase_config:", parseError);
                            setError(`–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Firebase: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ __firebase_config –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∞ (–±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏).`);
                            setLoading(false);
                            return;
                        }
                    } else {
                        console.warn("–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è __firebase_config –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏.");
                    }


                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    if (!firebaseConfigObject.apiKey || !firebaseConfigObject.authDomain || !firebaseConfigObject.projectId) {
                        const missingParts = [];
                        if (!firebaseConfigObject.apiKey) missingParts.push('apiKey');
                        if (!firebaseConfigObject.authDomain) missingParts.push('authDomain');
                        if (!firebaseConfigObject.projectId) missingParts.push('projectId');
                        const errorMessage = `–ù–µ–ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç: ${missingParts.join(', ')}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å—Ç–∞–≤–∏–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–π –∫–æ–Ω—Å–æ–ª–∏ Firebase.`;
                        console.error(errorMessage);
                        setError(errorMessage); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                        setLoading(false);
                        return; // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–≤–µ—Ä–Ω–∞
                    }

                    console.log("Firebase config object used for initialization:", firebaseConfigObject); // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ª–æ–≥ –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π

                    const app = initializeApp(firebaseConfigObject);
                    const firestoreDb = getFirestore(app);
                    const firebaseAuth = getAuth(app);

                    setDb(firestoreDb);
                    setAuth(firebaseAuth);

                    const unsubscribe = onAuthStateChanged(firebaseAuth, async (user) => {
                        if (user) {
                            setUserId(user.uid);
                            setUserEmail(user.email);
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                            const userDocRef = doc(firestoreDb, `artifacts/${appIdValue}/users/${user.uid}/profile`, 'data');
                            const userDocSnap = await getDoc(userDocRef);
                            if (userDocSnap.exists()) {
                                setIsAdmin(userDocSnap.data().isAdmin || false);
                                setCurrentPage('dashboard'); // –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –¥–∞—à–±–æ—Ä–¥ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
                            } else {
                                // –î–ª—è –≤–Ω–æ–≤—å –≤–æ—à–µ–¥—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è
                                await setDoc(userDocRef, {
                                    firstName: '',
                                    lastName: '',
                                    email: user.email,
                                    isAdmin: false,
                                });
                                setIsAdmin(false);
                                setCurrentPage('dashboard');
                            }
                            setShowLoginPopup(false); // –°–∫—Ä—ã—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                        } else {
                            setUserId(null);
                            setUserEmail(null);
                            setIsAdmin(false);
                            setCurrentPage('login'); // –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞
                            setShowLoginPopup(true); // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
                        }
                        setIsAuthReady(true);
                        setLoading(false);
                    });

                    // –ü–æ–ø—ã—Ç–∫–∞ –≤–æ–π—Ç–∏ —Å –ø–æ–º–æ—â—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                    if (initialAuthToken && firebaseAuth && !firebaseAuth.currentUser) {
                        signInWithCustomToken(firebaseAuth, initialAuthToken)
                            .then(() => {
                                console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ç–æ–∫–µ–Ω–æ–º.");
                                // setShowLoginPopup(false) —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–ª—É—à–∞—Ç–µ–ª–µ–º onAuthStateChanged
                            })
                            .catch((error) => {
                                console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ç–æ–∫–µ–Ω–æ–º:", error);
                                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥ –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ –æ—Ç–∫—Ä—ã—Ç—ã–º
                                signInAnonymously(firebaseAuth).then(() => {
                                    console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –∞–Ω–æ–Ω–∏–º–Ω–æ.");
                                    // setShowLoginPopup(false) —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–ª—É—à–∞—Ç–µ–ª–µ–º onAuthStateChanged
                                }).catch((anonError) => {
                                    console.error("–û—à–∏–±–∫–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –≤—Ö–æ–¥–∞:", anonError);
                                    setError("–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                                    setShowLoginPopup(true);
                                });
                            });
                    } else if (!firebaseAuth.currentUser) {
                        // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –≤–æ—à–µ–ª, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥
                        signInAnonymously(firebaseAuth).then(() => {
                            console.log("–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –∞–Ω–æ–Ω–∏–º–Ω–æ.");
                            // setShowLoginPopup(false) —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–ª—É—à–∞—Ç–µ–ª–µ–º onAuthStateChanged
                        }).catch((anonError) => {
                            console.error("–û—à–∏–±–∫–∞ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –≤—Ö–æ–¥–∞:", anonError);
                            setError("–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                            setShowLoginPopup(true);
                        });
                    }

                    return () => unsubscribe();
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", e);
                    setError("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.");
                    setLoading(false);
                }
            }, []);

            const handleLogout = async () => {
                try {
                    await signOut(auth);
                    setCurrentPage('login');
                    setShowLoginPopup(true);
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:", error);
                    setError("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞.");
                }
            };

            const handleLogin = async (email, password) => {
                setLoading(true);
                setError(null);
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    // setShowLoginPopup(false) –∏ setCurrentPage('dashboard') —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è onAuthStateChanged
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:", error);
                    setError("–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –∏–ª–∏ –ø–∞—Ä–æ–ª—å.");
                } finally {
                    setLoading(false);
                }
            };

            const toggleProfilePopup = () => {
                setShowProfilePopup(!showProfilePopup);
            };

            const setPageAndSelection = (page, categoryId = null, categoryName = null, docCategoryId = null, docCategoryName = null, docTypeId = null, docTypeName = null) => {
                setCurrentPage(page);
                setSelectedCategoryId(categoryId);
                setSelectedCategoryName(categoryName);
                setSelectedDocumentCategoryId(docCategoryId);
                setSelectedDocumentCategoryName(docCategoryName);
                setSelectedDocumentTypeId(docTypeId);
                setSelectedDocumentTypeName(docTypeName);
            };

            if (loading || !isAuthReady) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-gray-100">
                        <div className="text-xl text-gray-700">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-red-100 text-red-700">
                        <div className="text-xl">{error}</div>
                    </div>
                );
            }

            return (
                <FirebaseContext.Provider value={{ db, auth, userId, isAdmin, userEmail }}>
                    <div className="flex min-h-screen font-inter">
                        {/* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */}
                        <div className="w-64 bg-blue-800 text-white p-4 flex flex-col rounded-r-lg shadow-lg">
                            <div className="flex items-center mb-6">
                                <img src="https://placehold.co/40x40/ffffff/000000?text=CC" alt="–õ–æ–≥–æ—Ç–∏–ø Compliance Connect" className="rounded-full mr-3" />
                                <h1 className="text-2xl font-bold">Compliance Connect</h1>
                            </div>
                            <nav className="flex-grow">
                                <ul>
                                    <SidebarMenuItem icon="üìä" label="–ü–∞–Ω–µ–ª—å –ø—Ä–∏–±–æ—Ä–æ–≤" page="dashboard" currentPage={currentPage} setCurrentPage={setPageAndSelection} />
                                    <SidebarMenuItem icon="üóÇÔ∏è" label="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏" page="categories" currentPage={currentPage} setCurrentPage={setPageAndSelection} />
                                    <SidebarMenuItem icon="üìÑ" label="–î–æ–∫—É–º–µ–Ω—Ç—ã" page="documents" currentPage={currentPage} setCurrentPage={setPageAndSelection} />
                                    {isAdmin && <SidebarMenuItem icon="üë•" label="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" page="users" currentPage={currentPage} setCurrentPage={setPageAndSelection} />}
                                </ul>
                            </nav>
                            <div className="mt-auto text-sm text-center opacity-75">
                                <p>–í–∞—à ID: {userId}</p>
                            </div>
                        </div>

                        {/* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */}
                        <div className="flex-1 flex flex-col bg-gray-100 rounded-l-lg shadow-inner">
                            {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
                            <header className="bg-white p-4 border-b border-gray-200 flex justify-between items-center rounded-tr-lg">
                                <h2 className="text-xl font-semibold text-gray-800">
                                    {currentPage === 'dashboard' && '–ü–∞–Ω–µ–ª—å –ø—Ä–∏–±–æ—Ä–æ–≤'}
                                    {currentPage === 'categories' && '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏'}
                                    {currentPage === 'documents' && '–î–æ–∫—É–º–µ–Ω—Ç—ã'}
                                    {currentPage === 'users' && '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏'}
                                    {currentPage === 'tasks' && `–ó–∞–¥–∞—á–∏: ${selectedCategoryName || ''}`}
                                    {currentPage === 'documentTypes' && `–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${selectedDocumentCategoryName || ''}`}
                                    {currentPage === 'documentArchive' && `–ê—Ä—Ö–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${selectedDocumentTypeName || ''}`}
                                </h2>
                                {userEmail && (
                                    <div className="relative">
                                        <button
                                            onClick={toggleProfilePopup}
                                            className="text-blue-700 font-medium hover:text-blue-900 focus:outline-none"
                                        >
                                            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {userEmail}!
                                        </button>
                                        {showProfilePopup && (
                                            <ProfilePopup
                                                onClose={toggleProfilePopup}
                                                onLogout={handleLogout}
                                                userId={userId}
                                            />
                                        )}
                                    </div>
                                )}
                            </header>

                            {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
                            <main className="flex-1 p-6 overflow-auto">
                                {currentPage === 'login' && showLoginPopup && (
                                    <LoginPopup onLogin={handleLogin} error={error} onClose={() => setShowLoginPopup(false)} />
                                )}
                                {currentPage === 'dashboard' && !showLoginPopup && <Dashboard displayMessage={displayMessage} />}
                                {currentPage === 'categories' && !showLoginPopup && <Categories setCurrentPage={setPageAndSelection} displayMessage={displayMessage} />}
                                {currentPage === 'tasks' && !showLoginPopup && <Tasks selectedCategoryId={selectedCategoryId} selectedCategoryName={selectedCategoryName} setCurrentPage={setPageAndSelection} displayMessage={displayMessage} />}
                                {currentPage === 'documents' && !showLoginPopup && <Documents setCurrentPage={setPageAndSelection} />}
                                {currentPage === 'documentTypes' && !showLoginPopup && <DocumentTypes selectedDocumentCategoryId={selectedDocumentCategoryId} selectedDocumentCategoryName={selectedDocumentCategoryName} setCurrentPage={setPageAndSelection} displayMessage={displayMessage} />}
                                {currentPage === 'documentArchive' && !showLoginPopup && <DocumentArchive selectedDocumentTypeId={selectedDocumentTypeId} selectedDocumentTypeName={selectedDocumentTypeName} displayMessage={displayMessage} />}
                                {currentPage === 'users' && !showLoginPopup && <Users displayMessage={displayMessage} />}
                            </main>
                        </div>
                    </div>
                    <Modal
                        show={showGenericMessageModal}
                        title={genericMessageTitle}
                        message={genericMessageContent}
                        onClose={() => setShowGenericMessageModal(false)}
                        showCancel={false}
                    />
                </FirebaseContext.Provider>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—É–Ω–∫—Ç–∞ –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é
        const SidebarMenuItem = ({ icon, label, page, currentPage, setCurrentPage }) => {
            const isActive = currentPage === page;
            return (
                <li className="mb-2">
                    <button
                        onClick={() => setCurrentPage(page)}
                        className={`flex items-center w-full p-3 rounded-lg transition-all duration-200 ${isActive ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-blue-700 hover:text-white'}`}
                    >
                        <span className="mr-3 text-xl">{icon}</span>
                        <span>{label}</span>
                    </button>
                </li>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞
        const LoginPopup = ({ onLogin, error, onClose }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                await onLogin(email, password);
                setIsLoading(false);
            };

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50">
                    <div className="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
                        <div className="flex justify-center mb-6">
                            <img src="https://placehold.co/60x60/ffffff/000000?text=CC" alt="–õ–æ–≥–æ—Ç–∏–ø Compliance Connect" className="rounded-full mr-3 bg-blue-800" />
                            <h2 className="text-3xl font-bold text-blue-800">Compliance Connect</h2>
                        </div>
                        <h3 className="text-2xl font-semibold text-gray-700 mb-6 text-center">–í—Ö–æ–¥</h3>
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="email">
                                    –ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
                                </label>
                                <input
                                    type="email"
                                    id="email"
                                    className="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="janedoe@there.com"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="password">
                                    –ü–∞—Ä–æ–ª—å
                                </label>
                                <input
                                    type="password"
                                    id="password"
                                    className="shadow appearance-none border rounded w-full py-3 px-4 text-gray-700 mb-3 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="**********"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            {error && <p className="text-red-500 text-xs italic mb-4 text-center">{error}</p>}
                            <div className="flex items-center justify-between mb-6">
                                <label className="flex items-center text-gray-700 text-sm">
                                    <input type="checkbox" className="form-checkbox h-4 w-4 text-blue-600 rounded" />
                                    <span className="ml-2">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</span>
                                </label>
                                <a href="#" className="inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800">
                                    –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?
                                </a>
                            </div>
                            <button
                                type="submit"
                                className="bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-6 rounded-lg w-full transition duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 flex items-center justify-center"
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <svg className="animate-spin h-5 w-5 text-white mr-3" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                ) : '–í–æ–π—Ç–∏'}
                            </button>
                            <button
                                type="button"
                                onClick={onClose}
                                className="mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg w-full transition duration-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50"
                            >
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è
        const ProfilePopup = ({ onClose, onLogout, userId }) => {
            const { db, auth } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [firstName, setFirstName] = useState('');
            const [lastName, setLastName] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [message, setMessage] = useState('');

            useEffect(() => {
                const fetchUserProfile = async () => {
                    if (db && userId) {
                        const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`, 'data');
                        const userDocSnap = await getDoc(userDocRef);
                        if (userDocSnap.exists()) {
                            const data = userDocSnap.data();
                            setFirstName(data.firstName || '');
                            setLastName(data.lastName || '');
                            setEmail(data.email || auth.currentUser?.email || '');
                        } else {
                            setEmail(auth.currentUser?.email || '');
                        }
                    }
                };
                fetchUserProfile();
            }, [db, userId, auth, appId]);

            const handleSaveChanges = async () => {
                setMessage('');
                try {
                    if (db && userId && auth.currentUser) {
                        const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`, 'data');
                        await setDoc(userDocRef, {
                            firstName,
                            lastName,
                            email,
                        }, { merge: true });

                        if (auth.currentUser.email !== email) {
                            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
                            setMessage('–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞. –î–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥.');
                        }
                        if (password) {
                            await auth.currentUser.updatePassword(password);
                            setMessage('–ü–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω.');
                        }
                        setMessage('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—è:", error);
                    setMessage(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`);
                }
            };

            return (
                <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg py-4 z-10 border border-gray-200">
                    <button onClick={onClose} className="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
                        <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <h3 className="text-xl font-semibold text-gray-800 px-4 mb-4">–ü—Ä–æ—Ñ–∏–ª—å</h3>
                    <div className="px-4">
                        <div className="mb-3">
                            <label className="block text-gray-700 text-sm font-bold mb-1">–ò–º—è</label>
                            <input
                                type="text"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={firstName}
                                onChange={(e) => setFirstName(e.target.value)}
                            />
                        </div>
                        <div className="mb-3">
                            <label className="block text-gray-700 text-sm font-bold mb-1">–§–∞–º–∏–ª–∏—è</label>
                            <input
                                type="text"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={lastName}
                                onChange={(e) => setLastName(e.target.value)}
                            />
                        </div>
                        <div className="mb-3">
                            <label className="block text-gray-700 text-sm font-bold mb-1">–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã</label>
                            <input
                                type="email"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                            />
                        </div>
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-1">–ü–∞—Ä–æ–ª—å</label>
                            <input
                                type="password"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                placeholder="**********"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                            />
                        </div>
                        {message && <p className="text-sm text-center mb-3 text-green-600">{message}</p>}
                        <button
                            onClick={handleSaveChanges}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg w-full mb-2 transition duration-200"
                        >
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                        <button
                            onClick={onLogout}
                            className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg w-full transition duration-200"
                        >
                            –í–´–ô–¢–ò
                        </button>
                    </div>
                </div>
            );
        };

        // –ú–æ–¥–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–æ–±—â–∏–π)
        const Modal = ({ show, title, message, children, onClose, onConfirm, showCancel = true, confirmText = "–û–ö", cancelText = "–û—Ç–º–µ–Ω–∞" }) => {
            if (!show) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white p-6 rounded-lg shadow-2xl w-full max-w-md">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-semibold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">
                                <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        {message && <p className="text-gray-700 mb-4">{message}</p>}
                        {children}
                        <div className="flex justify-end space-x-3 mt-4">
                            {showCancel && (
                                <button
                                    onClick={onClose}
                                    className="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-200"
                                >
                                    {cancelText}
                                </button>
                            )}
                            {onConfirm && (
                                <button
                                    onClick={onConfirm}
                                    className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200"
                                >
                                    {confirmText}
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const Dashboard = ({ displayMessage }) => {
            const { db, userId, isAdmin } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [tasks, setTasks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showConfirmDoneModal, setShowConfirmDoneModal] = useState(false);
            const [currentTaskToComplete, setCurrentTaskToComplete] = useState(null);
            const [confirmDoneMessage, setConfirmDoneMessage] = useState('');

            useEffect(() => {
                if (!db || !userId) return;

                // –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –∑–∞–¥–∞—á–∏ —è–≤–ª—è—é—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∏–ª–∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
                const q = query(collection(db, `artifacts/${appId}/public/data/tasks`));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const fetchedTasks = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞, —Ç–∞–∫ –∫–∞–∫ orderBy() –∏–∑–±–µ–≥–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
                    fetchedTasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                    setTasks(fetchedTasks);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞—á:", error);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [db, userId, appId]);

            const handleUploadDoc = (taskId) => {
                displayMessage("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞", "–§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —ç—Ç–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω.");
            };

            const handleMarkAsDone = (task) => {
                setCurrentTaskToComplete(task);
                if (!task.documentAttached) { // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –ø–æ–ª–µ `documentAttached` –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
                    setConfirmDoneMessage("–î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?");
                    setShowConfirmDoneModal(true);
                } else {
                    setConfirmDoneMessage("–≠—Ç–∞ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è. –í—ã —É–≤–µ—Ä–µ–Ω—ã?");
                    setShowConfirmDoneModal(true);
                }
            };

            const confirmTaskCompletion = async () => {
                setShowConfirmDoneModal(false);
                if (!currentTaskToComplete) return;

                try {
                    const taskDocRef = doc(db, `artifacts/${appId}/public/data/tasks`, currentTaskToComplete.id);
                    const originalDueDate = new Date(currentTaskToComplete.dueDate);
                    let newDueDate = new Date(originalDueDate);

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —á–∞—Å—Ç–æ—Ç—ã
                    switch (currentTaskToComplete.frequency) {
                        case '–ï–∂–µ–≥–æ–¥–Ω–æ':
                            newDueDate.setFullYear(newDueDate.getFullYear() + 1);
                            break;
                        case '–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ':
                            newDueDate.setMonth(newDueDate.getMonth() + 3);
                            break;
                        case '–ö–∞–∂–¥—ã–µ 3 –≥–æ–¥–∞':
                            newDueDate.setFullYear(newDueDate.getFullYear() + 3);
                            break;
                        case '–ï–∂–µ–º–µ—Å—è—á–Ω–æ':
                            newDueDate.setMonth(newDueDate.getMonth() + 1);
                            break;
                        default:
                            newDueDate.setDate(newDueDate.getDate() + 30); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –µ–∂–µ–º–µ—Å—è—á–Ω–æ, –µ—Å–ª–∏ —á–∞—Å—Ç–æ—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞
                    }

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 'done' –≤ false, —á—Ç–æ–±—ã –∑–∞–¥–∞—á–∞ —Å–Ω–æ–≤–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—Ä–æ–∫–∞
                    await updateDoc(taskDocRef, {
                        done: false, // –ó–∞–¥–∞—á–∞ "–≤—ã–ø–æ–ª–Ω–µ–Ω–∞" –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ü–∏–∫–ª—É
                        dueDate: newDueDate.toISOString().split('T')[0], // –§–æ—Ä–º–∞—Ç –ì–ì–ì–ì-–ú–ú-–î–î
                    });

                    displayMessage("–°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏", "–≠—Ç–∞ –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª.");
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π:", error);
                    displayMessage("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏", `–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π: ${error.message}`);
                } finally {
                    setCurrentTaskToComplete(null);
                }
            };

            const filterTasks = (tasksList, days) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0); // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ –Ω–∞—á–∞–ª–∞ –¥–Ω—è

                return tasksList.filter(task => {
                    const dueDate = new Date(task.dueDate);
                    dueDate.setHours(0, 0, 0, 0); // –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ –Ω–∞—á–∞–ª–∞ –¥–Ω—è

                    const diffTime = dueDate.getTime() - today.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (days === 'overdue') {
                        return diffDays < 0;
                    } else if (days === 30) {
                        return diffDays >= 0 && diffDays <= 30;
                    } else if (days === 90) {
                        return diffDays > 30 && diffDays <= 90;
                    }
                    return false;
                }).sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)); // –£–±–µ–¥–∏—Ç—å—Å—è –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ –ø–æ —Å—Ä–æ–∫—É
            };

            const overdueTasks = filterTasks(tasks, 'overdue');
            const dueNext30DaysTasks = filterTasks(tasks, 30);
            const dueNext90DaysTasks = filterTasks(tasks, 90);

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>;
            }

            return (
                <div className="space-y-6">
                    <Modal
                        show={showConfirmDoneModal}
                        title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏"
                        message={confirmDoneMessage}
                        onClose={() => setShowConfirmDoneModal(false)}
                        onConfirm={confirmTaskCompletion}
                        confirmText="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
                        cancelText="–û—Ç–º–µ–Ω–∞"
                    />

                    {/* –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ */}
                    <section className="bg-white p-6 rounded-lg shadow">
                        <h3 className="text-xl font-semibold text-red-600 mb-4">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</h3>
                        {overdueTasks.length === 0 ? (
                            <p className="text-gray-600">–ù–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.</p>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–¥–∞—á–∞</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°—Ä–æ–∫</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–î–æ–∫—É–º–µ–Ω—Ç</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {overdueTasks.map((task) => (
                                            <tr key={task.id}>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-red-700">{task.name}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{task.category}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-red-500 font-bold">{task.dueDate} <span className="text-red-700 ml-2">–ü–†–û–°–†–û–ß–ï–ù–û</span></td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                                    <button
                                                        onClick={() => handleUploadDoc(task.id)}
                                                        className="bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-1 px-3 rounded-full text-xs"
                                                    >
                                                        {task.documentAttached ? '–ó–∞–º–µ–Ω–∏—Ç—å PDF' : '–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å PDF'}
                                                    </button>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    <input
                                                        type="checkbox"
                                                        checked={task.done}
                                                        onChange={() => handleMarkAsDone(task)}
                                                        className="form-checkbox h-5 w-5 text-blue-600 rounded-md"
                                                    />
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </section>

                    {/* –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–∏–µ 30 –¥–Ω–µ–π */}
                    <section className="bg-white p-6 rounded-lg shadow">
                        <h3 className="text-xl font-semibold text-blue-700 mb-4">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–∏–µ 30 –¥–Ω–µ–π</h3>
                        {dueNext30DaysTasks.length === 0 ? (
                            <p className="text-gray-600">–ù–µ—Ç –∑–∞–¥–∞—á, —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–µ 30 –¥–Ω–µ–π.</p>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–¥–∞—á–∞</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°—Ä–æ–∫</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–≥—Ä—É–∑–∏—Ç—å</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {dueNext30DaysTasks.map((task) => (
                                            <tr key={task.id}>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{task.name}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{task.category}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{task.dueDate}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                                    <button
                                                        onClick={() => handleUploadDoc(task.id)}
                                                        className="bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-1 px-3 rounded-full text-xs"
                                                    >
                                                        {task.documentAttached ? '–ó–∞–º–µ–Ω–∏—Ç—å PDF' : '–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å PDF'}
                                                    </button>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    <input
                                                        type="checkbox"
                                                        checked={task.done}
                                                        onChange={() => handleMarkAsDone(task)}
                                                        className="form-checkbox h-5 w-5 text-blue-600 rounded-md"
                                                    />
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </section>

                    {/* –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–∏–µ 90 –¥–Ω–µ–π */}
                    <section className="bg-white p-6 rounded-lg shadow">
                        <h3 className="text-xl font-semibold text-green-700 mb-4">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–∏–µ 90 –¥–Ω–µ–π</h3>
                        {dueNext90DaysTasks.length === 0 ? (
                            <p className="text-gray-600">–ù–µ—Ç –∑–∞–¥–∞—á, —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–µ 90 –¥–Ω–µ–π.</p>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–¥–∞—á–∞</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°—Ä–æ–∫</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–≥—Ä—É–∑–∏—Ç—å</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {dueNext90DaysTasks.map((task) => (
                                            <tr key={task.id}>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{task.name}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{task.category}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{task.dueDate}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                                    <button
                                                        onClick={() => handleUploadDoc(task.id)}
                                                        className="bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-1 px-3 rounded-full text-xs"
                                                    >
                                                        {task.documentAttached ? '–ó–∞–º–µ–Ω–∏—Ç—å PDF' : '–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å PDF'}
                                                    </button>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                    <input
                                                        type="checkbox"
                                                        checked={task.done}
                                                        onChange={() => handleMarkAsDone(task)}
                                                        className="form-checkbox h-5 w-5 text-blue-600 rounded-md"
                                                    />
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </section>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        const Categories = ({ setCurrentPage, displayMessage }) => {
            const { db, userId } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [categoryToDelete, setCategoryToDelete] = useState(null);
            const [deleteMessage, setDeleteMessage] = useState('');
            const [showAddCategoryModal, setShowAddCategoryModal] = useState(false);
            const [newCategoryName, setNewCategoryName] = useState('');

            useEffect(() => {
                if (!db || !userId) return;

                const unsubscribeCategories = onSnapshot(collection(db, `artifacts/${appId}/public/data/categories`), (snapshot) => {
                    const fetchedCategories = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setCategories(fetchedCategories);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π:", error);
                    setLoading(false);
                });

                // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∑–∞–¥–∞—á, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
                const unsubscribeTasks = onSnapshot(collection(db, `artifacts/${appId}/public/data/tasks`), (snapshot) => {
                    const allTasks = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    setCategories(prevCategories => {
                        return prevCategories.map(category => {
                            const tasksInCategory = allTasks.filter(task => task.category === category.name);
                            const tasksDue = tasksInCategory.filter(task => new Date(task.dueDate) < new Date()).length;
                            const tasksNext30Days = tasksInCategory.filter(task => {
                                const today = new Date();
                                const dueDate = new Date(task.dueDate);
                                const diffTime = dueDate.getTime() - today.getTime();
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                return diffDays >= 0 && diffDays <= 30;
                            }).length;

                            // –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–π —Å—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                            const nextDueDateTask = tasksInCategory
                                .filter(task => new Date(task.dueDate) >= new Date()) // –¢–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ –∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –∑–∞–¥–∞—á–∏
                                .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))[0];
                            const nextDueDate = nextDueDateTask ? nextDueDateTask.dueDate : '–ù–ï–¢';

                            return {
                                ...category,
                                tasksDue: tasksInCategory.length, // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                                tasksNext30Days: tasksNext30Days,
                                nextDueDate: nextDueDate,
                            };
                        });
                    });
                });

                return () => {
                    unsubscribeCategories();
                    unsubscribeTasks();
                };
            }, [db, userId, appId]);

            const handleDeleteCategoryClick = (category) => {
                setCategoryToDelete(category);
                if (category.tasksDue > 0) {
                    setDeleteMessage("–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –µ–µ –∑–∞–¥–∞—á–∏.");
                    setShowDeleteModal(true);
                } else {
                    setDeleteMessage(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${category.name}"?`);
                    setShowDeleteModal(true);
                }
            };

            const confirmDeleteCategory = async () => {
                setShowDeleteModal(false);
                if (!categoryToDelete) return;

                if (categoryToDelete.tasksDue > 0) {
                    console.log("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –∑–∞–¥–∞—á–∞–º–∏.");
                    return;
                }

                try {
                    const categoryDocRef = doc(db, `artifacts/${appId}/public/data/categories`, categoryToDelete.id);
                    await deleteDoc(categoryDocRef);
                    setCategoryToDelete(null);
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:", error);
                    displayMessage("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", `–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${error.message}`);
                }
            };

            const handleAddCategory = async () => {
                if (!newCategoryName.trim()) {
                    displayMessage("–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞", "–ò–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.");
                    return;
                }
                setShowAddCategoryModal(false);
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/categories`), {
                        name: newCategoryName,
                        nextDueDate: '–ù–ï–¢', // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        tasksDue: 0, // –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–ª—É—à–∞—Ç–µ–ª–µ–º –∑–∞–¥–∞—á
                        tasksNext30Days: 0, // –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–ª—É—à–∞—Ç–µ–ª–µ–º –∑–∞–¥–∞—á
                    });
                    setNewCategoryName('');
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:", error);
                    displayMessage("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", `–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${error.message}`);
                }
            };

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</div>;
            }

            return (
                <div className="p-6">
                    <button
                        onClick={() => setShowAddCategoryModal(true)}
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-6 transition duration-200"
                    >
                        + –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>

                    <Modal
                        show={showDeleteModal}
                        title="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é"
                        message={deleteMessage}
                        onClose={() => setShowDeleteModal(false)}
                        onConfirm={categoryToDelete?.tasksDue > 0 ? null : confirmDeleteCategory}
                        showCancel={categoryToDelete?.tasksDue === 0} // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ tasksDue = 0
                        confirmText={categoryToDelete?.tasksDue > 0 ? '–û–ö' : '–£–¥–∞–ª–∏—Ç—å'}
                    />

                    <Modal
                        show={showAddCategoryModal}
                        title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é"
                        onClose={() => setShowAddCategoryModal(false)}
                        onConfirm={handleAddCategory}
                        confirmText="–û–ö"
                    >
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="categoryName">
                                –ò–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
                            </label>
                            <input
                                type="text"
                                id="categoryName"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={newCategoryName}
                                onChange={(e) => setNewCategoryName(e.target.value)}
                                required
                            />
                        </div>
                    </Modal>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {categories.map((category) => (
                            <div key={category.id} className="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-semibold text-gray-800">{category.name}</h3>
                                    <button onClick={() => handleDeleteCategoryClick(category)} className="text-gray-500 hover:text-red-600 transition duration-200">
                                        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p className="text-gray-600 text-sm mb-2">
                                    –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: <span className={category.nextDueDate === '–ù–ï–¢' ? 'font-medium' : new Date(category.nextDueDate) < new Date() ? 'text-red-500 font-bold' : 'font-medium'}>
                                        {category.nextDueDate === '–ù–ï–¢' ? '–ù–ï–¢' : category.nextDueDate}
                                        {new Date(category.nextDueDate) < new Date() && category.nextDueDate !== '–ù–ï–¢' && <span className="ml-1 text-red-700">–ü–†–û–°–†–û–ß–ï–ù–û</span>}
                                    </span>
                                </p>
                                <p className="text-gray-600 text-sm mb-2">–ó–∞–¥–∞—á –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é: <span className="font-medium">{category.tasksDue}</span></p>
                                <p className="text-gray-600 text-sm mb-4">–ó–∞–¥–∞—á –≤ —Å–ª–µ–¥—É—é—â–∏–µ 30 –¥–Ω–µ–π: <span className="font-medium">{category.tasksNext30Days}</span></p>
                                <button
                                    onClick={() => setCurrentPage('tasks', category.id, category.name)}
                                    className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg w-full transition duration-200"
                                >
                                    –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–¥–∞—á (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
        const Tasks = ({ selectedCategoryId, selectedCategoryName, setCurrentPage, displayMessage }) => {
            const { db, userId } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [tasks, setTasks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showAddTaskModal, setShowAddTaskModal] = useState(false);
            const [newTask, setNewTask] = useState({ name: '', frequency: '', dueDate: '', category: selectedCategoryName || '' });
            const [categories, setCategories] = useState([]); // –î–ª—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏

            useEffect(() => {
                if (!db || !userId) return;

                let tasksQueryRef = collection(db, `artifacts/${appId}/public/data/tasks`);
                if (selectedCategoryId) {
                    tasksQueryRef = query(tasksQueryRef, where('category', '==', selectedCategoryName));
                }

                const unsubscribeTasks = onSnapshot(tasksQueryRef, (snapshot) => {
                    const fetchedTasks = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    fetchedTasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ä–æ–∫—É
                    setTasks(fetchedTasks);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞—á:", error);
                    setLoading(false);
                });

                const unsubscribeCategories = onSnapshot(collection(db, `artifacts/${appId}/public/data/categories`), (snapshot) => {
                    const fetchedCategories = snapshot.docs.map(doc => ({
                        id: doc.id,
                        name: doc.data().name
                    }));
                    setCategories(fetchedCategories);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –∑–∞–¥–∞—á:", error);
                });

                return () => {
                    unsubscribeTasks();
                    unsubscribeCategories();
                };
            }, [db, userId, appId, selectedCategoryId, selectedCategoryName]);

            const handleAddTask = async () => {
                if (!newTask.name || !newTask.frequency || !newTask.dueDate || !newTask.category) {
                    displayMessage("–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
                    return;
                }
                setShowAddTaskModal(false);
                try {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/tasks`), {
                        ...newTask,
                        done: false, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                        documentAttached: false, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞
                    });
                    setNewTask({ name: '', frequency: '', dueDate: '', category: selectedCategoryName || '' });
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:", error);
                    displayMessage("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏", `–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏: ${error.message}`);
                }
            };

            const handleUploadDoc = async (taskId) => {
                displayMessage("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞", "–§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏/–∑–∞–º–µ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —ç—Ç–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏.");
                // –ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—è documentAttached –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                try {
                    const taskDocRef = doc(db, `artifacts/${appId}/public/data/tasks`, taskId);
                    await updateDoc(taskDocRef, { documentAttached: true, documentUrl: 'https://example.com/mock-doc.pdf' });
                } catch (error) {
                    console.error("Error updating documentAttached status:", error);
                }
            };

            const handleMarkAsDone = async (task) => {
                try {
                    const taskDocRef = doc(db, `artifacts/${appId}/public/data/tasks`, task.id);
                    const originalDueDate = new Date(task.dueDate);
                    let newDueDate = new Date(originalDueDate);

                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —á–∞—Å—Ç–æ—Ç—ã
                    switch (task.frequency) {
                        case '–ï–∂–µ–≥–æ–¥–Ω–æ':
                            newDueDate.setFullYear(newDueDate.getFullYear() + 1);
                            break;
                        case '–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ':
                            newDueDate.setMonth(newDueDate.getMonth() + 3);
                            break;
                        case '–ö–∞–∂–¥—ã–µ 3 –≥–æ–¥–∞':
                            newDueDate.setFullYear(newDueDate.getFullYear() + 3);
                            break;
                        case '–ï–∂–µ–º–µ—Å—è—á–Ω–æ':
                            newDueDate.setMonth(newDueDate.getMonth() + 1);
                            break;
                        default:
                            newDueDate.setDate(newDueDate.getDate() + 30); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –µ–∂–µ–º–µ—Å—è—á–Ω–æ
                    }

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 'done' –≤ false, —á—Ç–æ–±—ã –∑–∞–¥–∞—á–∞ —Å–Ω–æ–≤–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—Ä–æ–∫–∞
                    await updateDoc(taskDocRef, {
                        done: false, // –ó–∞–¥–∞—á–∞ "–≤—ã–ø–æ–ª–Ω–µ–Ω–∞" –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ü–∏–∫–ª—É
                        dueDate: newDueDate.toISOString().split('T')[0], // –§–æ—Ä–º–∞—Ç –ì–ì–ì–ì-–ú–ú-–î–î
                    });
                    displayMessage("–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞", "–ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∏ —Å—Ä–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω.");
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π:", error);
                    displayMessage("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏", `–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –∑–∞–¥–∞—á–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π: ${error.message}`);
                }
            };

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>;
            }

            return (
                <div className="p-6">
                    <button
                        onClick={() => setShowAddTaskModal(true)}
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-6 transition duration-200"
                    >
                        + –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
                    </button>

                    <Modal
                        show={showAddTaskModal}
                        title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É"
                        onClose={() => setShowAddTaskModal(false)}
                        onConfirm={handleAddTask}
                        confirmText="–û–ö"
                    >
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="taskName">
                                –ò–º—è –∑–∞–¥–∞—á–∏:
                            </label>
                            <input
                                type="text"
                                id="taskName"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={newTask.name}
                                onChange={(e) => setNewTask({ ...newTask, name: e.target.value })}
                                required
                            />
                        </div>
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="taskCategory">
                                –ö–∞—Ç–µ–≥–æ—Ä–∏—è:
                            </label>
                            <select
                                id="taskCategory"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={newTask.category}
                                onChange={(e) => setNewTask({ ...newTask, category: e.target.value })}
                                required
                            >
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                {categories.map(cat => (
                                    <option key={cat.id} value={cat.name}>{cat.name}</option>
                                ))}
                            </select>
                        </div>
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="taskFrequency">
                                –ß–∞—Å—Ç–æ—Ç–∞:
                            </label>
                            <input
                                type="text"
                                id="taskFrequency"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={newTask.frequency}
                                onChange={(e) => setNewTask({ ...newTask, frequency: e.target.value })}
                                placeholder="–ï–∂–µ–≥–æ–¥–Ω–æ, –µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ –∏ —Ç.–¥."
                                required
                            />
                        </div>
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="taskDueDate">
                                –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
                            </label>
                            <input
                                type="date"
                                id="taskDueDate"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={newTask.dueDate}
                                onChange={(e) => setNewTask({ ...newTask, dueDate: e.target.value })}
                                required
                            />
                        </div>
                    </Modal>

                    <div className="overflow-x-auto bg-white rounded-lg shadow">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–¥–∞—á–∞</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ß–∞—Å—Ç–æ—Ç–∞</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°—Ä–æ–∫</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–≥—Ä—É–∑–∏—Ç—å</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {tasks.map((task) => (
                                    <tr key={task.id}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{task.name}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{task.frequency}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            <span className={new Date(task.dueDate) < new Date() ? 'text-red-500' : ''}>
                                                {task.dueDate}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                            <button
                                                onClick={() => handleUploadDoc(task.id)}
                                                className="bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-1 px-3 rounded-full text-xs"
                                            >
                                                {task.documentAttached ? '–ó–∞–º–µ–Ω–∏—Ç—å PDF' : '–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å PDF'}
                                            </button>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <input
                                                type="checkbox"
                                                checked={task.done}
                                                onChange={() => handleMarkAsDone(task)}
                                                className="form-checkbox h-5 w-5 text-blue-600 rounded-md"
                                            />
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
        const Documents = ({ setCurrentPage }) => {
            const { db, userId } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [docCategories, setDocCategories] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (!db || !userId) return;

                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∑–∞–¥–∞—á –∏ –∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ 'documentCategories'.
                const unsubscribeDocCategories = onSnapshot(collection(db, `artifacts/${appId}/public/data/documentCategories`), (snapshot) => {
                    const fetchedDocCategories = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setDocCategories(fetchedDocCategories);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:", error);
                    setLoading(false);
                });

                // –°–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                const unsubscribeDocuments = onSnapshot(collection(db, `artifacts/${appId}/public/data/documents`), (snapshot) => {
                    const allDocuments = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    setDocCategories(prevCategories => {
                        return prevCategories.map(category => {
                            const documentsInCategory = allDocuments.filter(doc => doc.category === category.name);
                            const documentTypesInCat = new Set(documentsInCategory.map(doc => doc.type));

                            return {
                                ...category,
                                documentTypesCount: documentTypesInCat.size,
                                filesCount: documentsInCategory.length,
                            };
                        });
                    });
                });

                return () => {
                    unsubscribeDocCategories();
                    unsubscribeDocuments();
                };
            }, [db, userId, appId]);

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</div>;
            }

            return (
                <div className="p-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {docCategories.map((docCat) => (
                            <div key={docCat.id} className="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                                <h3 className="text-xl font-semibold text-gray-800 mb-3">{docCat.name}</h3>
                                <p className="text-gray-600 text-sm mb-2">–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: <span className="font-medium">{docCat.documentTypesCount || 0}</span></p>
                                <p className="text-gray-600 text-sm mb-4">–§–∞–π–ª–æ–≤: <span className="font-medium">{docCat.filesCount || 0}</span></p>
                                <button
                                    onClick={() => setCurrentPage('documentTypes', null, null, docCat.id, docCat.name)}
                                    className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg w-full transition duration-200"
                                >
                                    –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø–æ –∑–∞–¥–∞—á–∞–º)
        const DocumentTypes = ({ selectedDocumentCategoryId, selectedDocumentCategoryName, setCurrentPage, displayMessage }) => {
            const { db, userId } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [documentTypes, setDocumentTypes] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [docTypeToDelete, setDocTypeToDelete] = useState(null);
            const [deleteMessage, setDeleteMessage] = useState('');

            useEffect(() => {
                if (!db || !userId) return;

                let docTypesQueryRef = collection(db, `artifacts/${appId}/public/data/documentTypes`);
                if (selectedDocumentCategoryId) {
                    docTypesQueryRef = query(docTypesQueryRef, where('category', '==', selectedDocumentCategoryName));
                }

                const unsubscribeDocTypes = onSnapshot(docTypesQueryRef, (snapshot) => {
                    const fetchedDocTypes = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setDocumentTypes(fetchedDocTypes);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:", error);
                    setLoading(false);
                });

                const unsubscribeDocuments = onSnapshot(collection(db, `artifacts/${appId}/public/data/documents`), (snapshot) => {
                    const allDocuments = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    setDocumentTypes(prevDocTypes => {
                        return prevDocTypes.map(docType => {
                            const documentsForType = allDocuments.filter(doc => doc.type === docType.name);
                            return {
                                ...docType,
                                documentsCount: documentsForType.length,
                            };
                        });
                    });
                });

                return () => {
                    unsubscribeDocTypes();
                    unsubscribeDocuments();
                };
            }, [db, userId, appId, selectedDocumentCategoryId, selectedDocumentCategoryName]);

            const handleDeleteDocTypeClick = (docType) => {
                setDocTypeToDelete(docType);
                if (docType.documentsCount > 0) {
                    setDeleteMessage("–ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã.");
                    setShowDeleteModal(true);
                } else {
                    setDeleteMessage(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ "${docType.name}"?`);
                    setShowDeleteModal(true);
                }
            };

            const confirmDeleteDocType = async () => {
                setShowDeleteModal(false);
                if (!docTypeToDelete) return;

                if (docTypeToDelete.documentsCount > 0) {
                    console.log("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏.");
                    return;
                }

                try {
                    const docTypeRef = doc(db, `artifacts/${appId}/public/data/documentTypes`, docTypeToDelete.id);
                    await deleteDoc(docTypeRef);
                    setDocTypeToDelete(null);
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:", error);
                    displayMessage("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞", `–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${error.message}`);
                }
            };

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</div>;
            }

            return (
                <div className="p-6">
                    <Modal
                        show={showDeleteModal}
                        title="–£–¥–∞–ª–∏—Ç—å —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞"
                        message={deleteMessage}
                        onClose={() => setShowDeleteModal(false)}
                        onConfirm={docTypeToDelete?.documentsCount > 0 ? null : confirmDeleteDocType}
                        showCancel={docTypeToDelete?.documentsCount === 0}
                        confirmText={docTypeToDelete?.documentsCount > 0 ? '–û–ö' : '–£–¥–∞–ª–∏—Ç—å'}
                    />

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {documentTypes.map((docType) => (
                            <div key={docType.id} className="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-semibold text-gray-800">{docType.name}</h3>
                                    <button onClick={() => handleDeleteDocTypeClick(docType)} className="text-gray-500 hover:text-red-600 transition duration-200">
                                        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <p className="text-gray-600 text-sm mb-4">–î–æ–∫—É–º–µ–Ω—Ç–æ–≤: <span className="font-medium">{docType.documentsCount || 0}</span></p>
                                <button
                                    onClick={() => setCurrentPage('documentArchive', null, null, null, null, docType.id, docType.name)}
                                    className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg w-full transition duration-200"
                                >
                                    –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞—Ä—Ö–∏–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        const DocumentArchive = ({ selectedDocumentTypeId, selectedDocumentTypeName, displayMessage }) => {
            const { db, userId } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [documents, setDocuments] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (!db || !userId) return;

                let documentsQueryRef = collection(db, `artifacts/${appId}/public/data/documents`);
                if (selectedDocumentTypeId) {
                    documentsQueryRef = query(documentsQueryRef, where('type', '==', selectedDocumentTypeName));
                }

                const unsubscribe = onSnapshot(documentsQueryRef, (snapshot) => {
                    const fetchedDocuments = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    fetchedDocuments.sort((a, b) => new Date(b.uploadedDate) - new Date(a.uploadedDate)); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–æ–≤–µ–π—à–∏–º
                    setDocuments(fetchedDocuments);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:", error);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [db, userId, appId, selectedDocumentTypeId, selectedDocumentTypeName]);

            const handleDownload = (documentUrl, filename) => {
                if (documentUrl) {
                    displayMessage("–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞", `–ù–∞—á–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞: ${filename}.`);
                    window.open(documentUrl, '_blank'); // –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                } else {
                    displayMessage("–û—à–∏–±–∫–∞", "–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.");
                }
            };

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ö–∏–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</div>;
            }

            return (
                <div className="p-6">
                    <div className="overflow-x-auto bg-white rounded-lg shadow">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ò–º—è —Ñ–∞–π–ª–∞</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ó–∞–≥—Ä—É–∂–µ–Ω–æ</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–°–∫–∞—á–∞—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {documents.map((doc) => (
                                    <tr key={doc.id}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{doc.filename}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{doc.suppliedBy}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{doc.uploadedDate}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-600">
                                            <button
                                                onClick={() => handleDownload(doc.url, doc.filename)}
                                                className="bg-blue-100 hover:bg-blue-200 text-blue-800 font-semibold py-1 px-3 rounded-full text-xs"
                                            >
                                                –°–∫–∞—á–∞—Ç—å
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
        const Users = ({ displayMessage }) => {
            const { db, userId, isAdmin } = useContext(FirebaseContext);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [userToDelete, setUserToDelete] = useState(null);
            const [showInviteUserModal, setShowInviteUserModal] = useState(false);
            const [inviteEmail, setInviteEmail] = useState('');
            const [inviteAdminStatus, setInviteAdminStatus] = useState(false);
            const [message, setMessage] = useState('');

            useEffect(() => {
                if (!db || !userId || !isAdmin) {
                    setLoading(false);
                    return;
                }

                // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è —á—Ç–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º)
                // –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore.
                const q = query(collection(db, `artifacts/${appId}/public/data/users`));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const fetchedUsers = snapshot.docs.map(d => ({
                        id: d.id,
                        ...d.data()
                    }));
                    setUsers(fetchedUsers);
                    setLoading(false);
                }, (error) => {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", error);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [db, userId, isAdmin, appId]);

            const toggleAdminStatus = async (user) => {
                if (!isAdmin) return; // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å
                try {
                    const userDocRef = doc(db, `artifacts/${appId}/public/data/users`, user.id);
                    await updateDoc(userDocRef, { isAdmin: !user.isAdmin });
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:", error);
                    displayMessage("–û—à–∏–±–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞", `–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ${error.message}`);
                }
            };

            const handleDeleteUserClick = (user) => {
                setUserToDelete(user);
                setShowDeleteModal(true);
            };

            const confirmDeleteUser = async () => {
                setShowDeleteModal(false);
                if (!userToDelete) return;

                try {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Firebase —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Auth –æ—Ç–¥–µ–ª—å–Ω–æ
                    // –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è Firestore. –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è.
                    const userDocRef = doc(db, `artifacts/${appId}/public/data/users`, userToDelete.id);
                    await deleteDoc(userDocRef);
                    setUserToDelete(null);
                    setMessage(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userToDelete.email} —É–¥–∞–ª–µ–Ω.`);
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
                    setMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`);
                }
            };

            const handleInviteUser = async () => {
                if (!inviteEmail.trim()) {
                    setMessage("–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.");
                    return;
                }
                setShowInviteUserModal(false);
                setMessage('');
                try {
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞
                    // –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º —á–µ—Ä–µ–∑ Firebase Admin SDK.
                    // –î–ª—è —ç—Ç–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –º—ã –∏–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firestore.
                    await addDoc(collection(db, `artifacts/${appId}/public/data/users`), {
                        email: inviteEmail,
                        firstName: '',
                        lastName: '',
                        isAdmin: inviteAdminStatus,
                        invitedAt: new Date().toISOString(),
                        status: 'pending_invitation' // –ü—Ä–∏–º–µ—Ä —Å—Ç–∞—Ç—É—Å–∞
                    });
                    setInviteEmail('');
                    setInviteAdminStatus(false);
                    setMessage(`–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${inviteEmail}.`);
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
                    setMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`);
                }
            };

            if (loading) {
                return <div className="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>;
            }

            if (!isAdmin) {
                return <div className="text-center text-red-500">–£ –≤–∞—Å –Ω–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.</div>;
            }

            return (
                <div className="p-6">
                    <button
                        onClick={() => setShowInviteUserModal(true)}
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg mb-6 transition duration-200"
                    >
                        + –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                    {message && <p className="text-center text-sm mb-4 text-green-600">{message}</p>}

                    <Modal
                        show={showDeleteModal}
                        title="–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                        message={`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${userToDelete?.email}"?`}
                        onClose={() => setShowDeleteModal(false)}
                        onConfirm={confirmDeleteUser}
                        confirmText="–£–¥–∞–ª–∏—Ç—å"
                        cancelText="–û—Ç–º–µ–Ω–∞"
                    />

                    <Modal
                        show={showInviteUserModal}
                        title="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                        onClose={() => setShowInviteUserModal(false)}
                        onConfirm={handleInviteUser}
                        confirmText="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å"
                    >
                        <div className="mb-4">
                            <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="inviteEmail">
                                –ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
                            </label>
                            <input
                                type="email"
                                id="inviteEmail"
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-blue-500"
                                value={inviteEmail}
                                onChange={(e) => setInviteEmail(e.target.value)}
                                required
                            />
                        </div>
                        <div className="mb-4 flex items-center">
                            <input
                                type="checkbox"
                                id="inviteAdmin"
                                className="form-checkbox h-5 w-5 text-blue-600 rounded"
                                checked={inviteAdminStatus}
                                onChange={(e) => setInviteAdminStatus(e.target.checked)}
                            />
                            <label className="ml-2 text-gray-700 text-sm font-bold" htmlFor="inviteAdmin">
                                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                            </label>
                        </div>
                    </Modal>

                    <div className="overflow-x-auto bg-white rounded-lg shadow">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–§–∞–º–∏–ª–∏—è</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ò–º—è</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ê–¥–º–∏–Ω</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–£–¥–∞–ª–∏—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {users.map((user) => (
                                    <tr key={user.id}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{user.lastName || 'N/A'}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{user.firstName || 'N/A'}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{user.email}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <input
                                                type="checkbox"
                                                checked={user.isAdmin || false}
                                                onChange={() => toggleAdminStatus(user)}
                                                className="form-checkbox h-5 w-5 text-blue-600 rounded-md"
                                                disabled={!isAdmin} // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å
                                            />
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            <button
                                                onClick={() => handleDeleteUserClick(user)}
                                                className="text-red-600 hover:text-red-800 transition duration-200"
                                                disabled={!isAdmin} // –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å
                                            >
                                                <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                </svg>
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
